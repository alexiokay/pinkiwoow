import{k as b,l as A,m as E,_ as q,p as P,f as T,t as j,q as x,w as N,h as R,j as D}from"./entry.f787c1f9.js";import{u as Q}from"./asyncData.271117ac.js";import{h as S}from"./index.9bb628c0.js";import{w as I,s as L}from"./utils.ec1ed42c.js";const m=(t,e)=>e.split(".").reduce((r,n)=>r&&r[n],t),$=(t,e)=>Object.keys(t).filter(e).reduce((r,n)=>Object.assign(r,{[n]:t[n]}),{}),M=t=>e=>Array.isArray(e)?e.map(r=>t(r)):t(e),k=t=>{const e=[],r=[];for(const n of t)["$","_"].includes(n)?e.push(n):r.push(n);return{prefixes:e,properties:r}},V=(t=[])=>e=>{if(t.length===0||!e)return e;const{prefixes:r,properties:n}=k(t);return $(e,s=>!n.includes(s)&&!r.includes(s[0]))},X=(t=[])=>e=>{if(t.length===0||!e)return e;const{prefixes:r,properties:n}=k(t);return $(e,s=>n.includes(s)||r.includes(s[0]))},H=(t,e)=>{const r=new Intl.Collator(e.$locale,{numeric:e.$numeric,caseFirst:e.$caseFirst,sensitivity:e.$sensitivity}),n=Object.keys(e).filter(s=>!s.startsWith("$"));for(const s of n)t=t.sort((i,u)=>{const a=[m(i,s),m(u,s)].map(l=>{if(l!==null)return l instanceof Date?l.toISOString():l});return e[s]===-1&&a.reverse(),r.compare(a[0],a[1])});return t},Z=(t,e="Expected an array")=>{if(!Array.isArray(t))throw new TypeError(e)},c=t=>Array.isArray(t)?t:t?[t]:[],B=["sort","where","only","without"],v=(t,e)=>{const r={...e};for(const i of B)r[i]&&(r[i]=c(r[i]));const n=(i,u=a=>a)=>(...a)=>(r[i]=u(...a),s),s={params:()=>r,only:n("only",c),without:n("without",c),where:n("where",i=>[...c(r.where),i]),sort:n("sort",i=>[...c(r.sort),...c(i)]),limit:n("limit",i=>parseInt(String(i),10)),skip:n("skip",i=>parseInt(String(i),10)),find:()=>t(s),findOne:()=>(r.first=!0,t(s)),findSurround:(i,u)=>(r.surround={query:i,...u},t(s)),locale:i=>s.where({_locale:i})};return s};function F(t){return JSON.stringify(t,G)}function G(t,e){return e instanceof RegExp?`--REGEX ${e.toString()}`:e}const g=t=>async e=>{var i;t&&(e.params().first&&(e.params().where||[]).length===0?e.where({_path:E(t)}):e.where({_path:new RegExp(`^${t.replace(/[-[\]{}()*+.,^$\s/]/g,"\\$&")}`)})),(i=e.params().sort)!=null&&i.length||e.sort({_file:1,$numeric:!0});const r=e.params(),n=I(`/query/${S(r)}.json`);if(L())return(await q(()=>import("./client-db.ab9f91ab.js"),["./client-db.ab9f91ab.js","./entry.f787c1f9.js","./entry.4f307de8.css","./index.68c44503.js","./_commonjsHelpers.cebfa718.js","./asyncData.271117ac.js","./index.9bb628c0.js","./utils.ec1ed42c.js"],import.meta.url).then(a=>a.useContentDatabase())).fetch(e);const s=await $fetch(n,{method:"GET",responseType:"json",params:{_params:F(r),previewToken:P("previewToken").value}});if(typeof s=="string"&&s.startsWith("<!DOCTYPE html>"))throw new Error("Not found");return s};function _(t,...e){return typeof t=="string"?v(g(b(A(t,...e)))):v(g(),t)}const J=T({name:"ContentQuery",props:{path:{type:String,required:!1,default:void 0},only:{type:Array,required:!1,default:void 0},without:{type:Array,required:!1,default:void 0},where:{type:Object,required:!1,default:void 0},sort:{type:Object,required:!1,default:void 0},limit:{type:Number,required:!1,default:void 0},skip:{type:Number,required:!1,default:void 0},locale:{type:String,required:!1,default:void 0},find:{type:String,required:!1,default:void 0}},async setup(t){const{path:e,only:r,without:n,where:s,sort:i,limit:u,skip:a,locale:l,find:d}=j(t),h=x(()=>{var o;return(o=e.value)==null?void 0:o.includes("/_")}),{data:y,refresh:p}=await Q(`content-query-${S(t)}`,()=>{let o;return e.value?o=_(e.value):o=_(),r.value&&(o=o.only(r.value)),n.value&&(o=o.without(n.value)),s.value&&(o=o.where(s.value)),i.value&&(o=o.sort(i.value)),u.value&&(o=o.limit(u.value)),a.value&&(o=o.skip(a.value)),l.value&&(o=o.where({_locale:l.value})),d.value==="one"?o.findOne():d.value==="surround"?e.value?o.findSurround(e):(console.warn("[Content] Surround queries requires `path` prop to be set."),console.warn("[Content] Query without `path` will return regular `find()` results."),o.find()):o.find()});return N(()=>t,()=>p(),{deep:!0}),{isPartial:h,data:y,refresh:p}},render(t){var w;const e=R(),{data:r,refresh:n,isPartial:s,path:i,only:u,without:a,where:l,sort:d,limit:h,skip:y,locale:p,find:o}=t,f={path:i,only:u,without:a,where:l,sort:d,limit:h,skip:y,locale:p,find:o};if(f.find==="one"){if(!r&&(e==null?void 0:e["not-found"]))return e["not-found"]({props:f,...this.$attrs});if((e==null?void 0:e.empty)&&(r==null?void 0:r._type)==="markdown"&&!((w=r==null?void 0:r.body)!=null&&w.children.length))return e.empty({props:f,...this.$attrs})}else if((!r||!r.length)&&e!=null&&e["not-found"])return e["not-found"]({props:f,...this.$attrs});return e!=null&&e.default?e.default({data:r,refresh:n,isPartial:s,props:f,...this.$attrs}):((C,O)=>D("pre",null,JSON.stringify({message:"You should use slots with <ContentQuery>!",slot:C,data:O},null,2)))("default",{data:r,props:f,isPartial:s})}}),ee=Object.freeze(Object.defineProperty({__proto__:null,default:J},Symbol.toStringTag,{value:"Module"}));export{ee as C,J as _,Z as a,M as b,X as c,v as d,c as e,m as g,F as j,H as s,V as w};
